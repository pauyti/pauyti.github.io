<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="shortcut icon" href="https://pauyti.github.io/favicon.jpg">
		<title>Pauyti</title>
		<style>
			button{
				cursor:pointer;
			}
			.a_btn{
				text-decoration:none;
			}
			#ventas img{
				cursor:pointer;
			}
			#main2{
				margin:Auto;
				display:none;
				padding:10px;
				width:600px;
				border:2px solid #4fffff;
				border-radius:20px;
			}
			.form input{
				width:400px;
				height:30px;
				padding:10px;
			}
			.form textarea{
				width:415px;
				height:90px;
				resize:none;
				overflow:auto;
				overflow-wrap:normal;
			}
			.form button{
				width:100px;
				height:40px;
				border-color:black;
				background-color:white;
				color:black;
			}
			.form button:hover{
				background-color:black;
				color:white;
			}
			.form div{
				height:100px;
			}
			
			.form{
				background-color:#ededed;
				margin:auto;
				width:600px;
			}
			#searchForm button{
				background-color:white;
				border-color:black;
				color:black;
				font-size:20px;
				width:100px;
				height:40px;
			}
			#searchForm button:hover{
				background-color:black;
				color:white;
			}
			#btn_pages button:hover{
				background-color:black;
				color:white;
			}
			#btn_pages button{
				width:80px;
				height:40px;
				background-color:white;
				border-color:black;
			}
		</style>
	</head>
	<body>
		<div id="main1" style="display:none;">
			<div style="height:660px;">
				<div style="position:absolute;left:0;right:0;top:0;height:660px;background-position:center center;background-size:cover;border:1px solid black;background-image:url('https://pauyti.github.io/img_div_main.jpg');">
					<div style="float:right;">
						<div style="float:right;width:15px;"></div>
						<h1 style="color:white;float:left;">Pauyti</h1>
					</div>
					<div style="margin:auto;width:460px;">
						<div style="height:220px;"></div>
						<div style="border:2px solid white;"></div>
						<div style="text-align:center;">
							<h1 style="color:white;font-size:60px;">Comprar</h1>
						</div>
						<div style="border:2px solid white;"></div>
					</div>
				</div>
			</div>
			<div style="height:10px;"></div>
			<div id="menu"></div>
			<div id="searchDiv" style="padding:10px;text-align:center;">
				<form id="searchForm" method="POST">
					<input style="width:300px;height:40px;" type="text" name="q" placeholder="Buscar">
					<button type="submit">Buscar</button>
				</form>
			</div>
			<div id="ventas" style="margin:auto;width:850px;height:1100px;"></div>
			<div id="btn_pages" style="margin:auto;text-align:center;">
				<button type="button" onclick="getPage(0);">Anterior</button>
				<button type="button" onclick="getPage(1);">Siguiente</button>
			</div>
		</div>
		<div id="main2">
			<div style="width:600px;height:600px;position:absolute;"></div>
			<img width="600px" id="img_main2">
			<form class="form" name="submit-form" id="form1" style="text-align:center;">
				<div style="height:20px;"></div>
				<h1>Comprar</h1>
				<div style="height:20px;"></div>
				<input type="hidden" name="formID" value="210954453517053">
				<input type="hidden" id="JWTContainer" value="">
				<input type="hidden" id="cardinalOrderNumber" value="">
				<div>
					<input name="q7_nombreY" placeholder="Nombre" type="text" required>
				</div>
				<div>
					<input name="q4_email" placeholder="Email" type="email" required>
				</div>
				<div>
					<input name="q5_numeroDe[full]" placeholder="Teléfono" type="text" required>
				</div>
				<div>
					<textarea placeholder="Mensaje (opcional)" name="q8_mensajeopcional"></textarea>
				</div>
				<div>
					<button type="button" onclick="history.back();">Cancelar</button>
					<button type="submit">Enviar</button>
				</div>
				<input name="q6_id" placeholder="id" type="text" hidden>
				<input type="text" name="website" value="" hidden>
				<input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="210954453517053-210954453517053">
				<input type="hidden" name="event_id" value="1617724352942_210954453517053_xgUtTpd">
			</form>
			<form class="form" name="submit2-form2" id="form2" style="display:none;text-align:center">
				<div style="height:20px;"></div>
				<h1>Solicitar</h1>
				<div style="height:20px;"></div>
				<input type="hidden" name="formID" value="210974579330360">
				<input type="hidden" id="JWTContainer" value="">
				<input type="hidden" id="cardinalOrderNumber" value="">
				<div>
					<input name="q7_nombreY" placeholder="Nombre" type="text" required>
				</div>
				<div>
					<input name="q4_email" placeholder="Email" type="email" required>
				</div>
				<div>
					<input name="q5_numeroDe[full]" placeholder="Teléfono" type="text" required>
				</div>
				<div>
					<textarea placeholder="Mensaje (opcional)" name="q8_mensajeopcional"></textarea>
				</div>
				<div>
					<button type="button" onclick="history.back();">Cancelar</button>
					<button type="submit">Enviar</button>
				</div>
				<input name="q6_id" placeholder="id" type="text" hidden>
				<input type="text" name="website" value="" hidden>
				<input type="hidden" class="simple_spc" id="simple_spc" name="simple_spc" value="210974579330360-210974579330360">
				<input type="hidden" name="event_id" value="1617894188718_210974579330360_rLQMpyF">
			</form>
		</div>
		<script type="text/javascript">
			var chars="abcdefghijklmnopqrstuvwxyz";
			chars+=chars.toUpperCase();
			chars+="0123456789.-_()/&%$#@|";
			
			function encrypt(id,phone){
				var result="";
				for (var x in phone){
					var number=phone[x];
					index=parseInt(number)+chars.indexOf(id[7]);
					char=chars[index];
					result+=char;
				}
				return result;
			}
			
			function decrypt(id,phone){
				var result="";
				for (var x in phone){
					var number=phone[x];
					index=chars.indexOf(number);
					index=parseInt(index)-chars.indexOf(id[7]);
					result+=index;
				}
				return result;
			}
		</script>
		<script type="text/javascript">
			var menu=document.getElementById("menu");
			var xhr=new XMLHttpRequest();
			xhr.onload=function(){
				var response=xhr.response;
				menu.innerHTML=response;
			};
			xhr.open("GET","https://pauyti.github.io/menu.txt",true);
			xhr.send();
		</script>
		<script type="text/javascript">
			const imgs=20;
			var page=1;
			var main1=document.getElementById("main1");
			var main2=document.getElementById("main2");
			var img_main2=document.getElementById("img_main2");
			var form1=document.getElementById("form1");
			var form2=document.getElementById("form2");
			var searchForm=document.getElementById("searchForm");
			var ventas_div=document.getElementById("ventas");
			var href=document.location.href;
			var url_imgs="https://pauyti.github.io/vender.json";
			var data;
			var urlParams=new URLSearchParams(href.split("?")[1]);
			if (Boolean(urlParams.get("page"))){
				page=parseInt(urlParams.get("page"));
			}
			function getPage(num){
				if (num==0){
					if (page>1){
						document.location.href=document.location.href.split("?")[0]+"?page="+(page-1);
					}
				}
				else{
					document.location.href=document.location.href.split("?")[0]+"?page="+(page+1);
				}
			}
			var xhr_imgs=new XMLHttpRequest();
			xhr_imgs.onload=function(){
				data=JSON.parse(xhr_imgs.response);
				var all_indexs=[];
				for (var y in data){
					all_indexs.push(parseInt(y));
				}
				var indexs=[];
				for (var x=all_indexs.length-imgs*page+1;x<all_indexs.length-imgs*(page-1)+1;x++){
					indexs.push(x);
				}
				for (var id in data){
					if (indexs.indexOf(parseInt(id))>=0){
						var src=data[id]["src"];
						ventas_div.innerHTML="<div onclick='document.location.href=document.location.href.split(\"?\")[0]+\"?id=\"+"+id+"' style='border:1px solid #dedede;float:left;width:210px;height:210px;text-align:center;'><div style='cursor:pointer;width:210px;height:210px;position:absolute;'></div><img width='100%' id='"+id+"' src='"+src+"'></div>"+ventas_div.innerHTML;
					}
				}
				var imgs_ventas=document.querySelectorAll("#ventas img");
				if (Boolean(urlParams.get("id"))){
					var id=urlParams.get("id");
					var src=data[id]["src"];
					img_main2.src=src;
					var inputs_id=document.querySelectorAll("input[name='q6_id']");
					for(var x=0;x<inputs_id.length;x++){
						inputs_id[x].value=id;
					}
					if (data[id]["vendido"]){
						form1.style.display="none";
						form2.style.display="block";
					}
					main2.style.display="block";
				}
				else{
					main1.style.display="block";
				}
			};
			xhr_imgs.open("GET",url_imgs,true);
			xhr_imgs.send()
			searchForm.addEventListener("submit",function(e){
				e.preventDefault();
				var q=this.querySelector("input[name='q']").value;
				var results="";
				q=q.toLowerCase();
				for (var id in data){
					img=data[id];
					if (Boolean(img.tags)){
						var tags=img.tags;
						if (Boolean(tags.match(q))){
							var src=data[id].src;
							results="<div onclick='document.location.href=document.location.href.split(\"?\")[0]+\"?id=\"+"+id+"' style='border:1px solid #dedede;float:left;width:210px;height:210px;text-align:center;'><div style='cursor:pointer;width:210px;height:210px;position:absolute;'></div><img width='100%' id='"+id+"' src='"+src+"'></div>"+results;
						}
						else{
							for (var tag in tags.split(",")){
								var t=tags.split(",")[tag];
								if(Boolean(q.match(t))){
									var src=data[id].src;
									results="<div onclick='document.location.href=document.location.href.split(\"?\")[0]+\"?id=\"+"+id+"' style='border:1px solid #dedede;float:left;width:210px;height:210px;text-align:center;'><div style='cursor:pointer;width:210px;height:210px;position:absolute;'></div><img width='100%' id='"+id+"' src='"+src+"'></div>"+results;
									break;
								}
							}
						}
					}
				}
				ventas_div.innerHTML=results;
			});
			const scriptURL1="https://submit.jotformeu.com/submit/210954453517053";
			const scriptURL2="https://submit.jotformeu.com/submit/210974579330360";
			form1.addEventListener("submit",e=>{
				e.preventDefault();
				fetch(scriptURL1,{method:"POST",body:new FormData(form1)})
					.then(response=>document.location.href="https://pauyti.github.io/comprar.html")
					.catch(error=>alert("Error! "+error.message));
			});
			form2.addEventListener("submit",e=>{
				e.preventDefault();
				fetch(scriptURL2,{method:"POST",body:new FormData(form2)})
					.then(response=>document.location.href="https://pauyti.github.io/comprar.html")
					.catch(error=>alert("Error! "+error.message));
			});
		</script>
		<!-- The core Firebase JS SDK is always required and must be listed first -->
		<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
		<!-- TODO: Add SDKs for Firebase products that you want to use
		https://firebase.google.com/docs/web/setup#available-libraries -->
		<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>
		<script>
			// Your web app's Firebase configuration
			// For Firebase JS SDK v7.20.0 and later, measurementId is optional
			var firebaseConfig = {
				apiKey: "AIzaSyDUbh8oB8HKoiIBaQ4RuIW7gIVhG8WhG6U",
				authDomain: "pauyti-1e847.firebaseapp.com",
				databaseURL: "https://pauyti-1e847-default-rtdb.firebaseio.com",
				projectId: "pauyti-1e847",
				storageBucket: "pauyti-1e847.appspot.com",
				messagingSenderId: "852649743660",
				appId: "1:852649743660:web:69368afd5b965dc128c889",
				measurementId: "G-T9Q28FSRDN"
			};
			// Initialize Firebase
			firebase.initializeApp(firebaseConfig);
			firebase.analytics();
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					var email=user.email;
					var name=user.displayName;
					var emails=document.querySelectorAll("form input[name='q4_email']");
					var names=document.querySelectorAll("form input[name='q7_nombreY']");
					firebase.database().ref("users/"+user.uid).on("value",function(snapshot){
						var telephone=snapshot.val().phone;
						telephone=decrypt(user.uid,telephone);
						var telephones=document.querySelectorAll("form input[name='q5_numeroDe[full]']");
						for (var a=0;a<telephones.length;a++){
							telephones[a].value=telephone;
						}
					});
					for (var x=0;x<emails.length;x++){
						emails[x].value=email;
					}
					for (var y=0;y<names.length;y++){
						names[y].value=name;
					}
				}
				else {
					// No user is signed in.
				}
			});
		</script>
		<!-- Go to www.addthis.com/dashboard to customize your tools -->
		<script type="text/javascript" src="https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-6069ec58c4d9d357"></script>
	</body>
</html>
